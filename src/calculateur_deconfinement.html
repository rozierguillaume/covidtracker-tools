<div class="wp-block-button is-style-outline"><a class="wp-block-button__link" href="https://covidtracker.fr">&lt; Retour <b>Accueil</b></a></div>

<!-- wp:html -->
<meta charset="utf-8">
	  <title>Chart.js Drag Data Points Plugin</title>
	  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

	  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>
	  <script src="assets/chartjs-plugin-dragdata.min.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata@latest/dist/chartjs-plugin-dragdata.min.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
	  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    
    <style>
	    html,
	    body {
	      margin: 0;
	      padding: 0;
	    }

	    canvas {
	      //background-color: #eee;
	      position: relative;
	    }

	    button {
                  border: 0px solid;
		  transition-duration: 0.4s;
                  background-color: #ffffff;
                  border-radius: 7px;
                   box-shadow: 6px 4px 10px #d6d6d6;
		}

		button:hover {
		  background-color: black; /* Green */
		  color: white;
		}
	  </style>
	


    
	<style>
	.myDiv {
	  border: 0px solid black;
          padding: 10px 30px;
          border-radius: 7px;
	  max-width: 800px;
	  /*text-align: center;*/
          box-shadow: 6px 4px 25px #d6d6d6;
	}
    .myDiv2 {
	  border: 0.5px solid black;
          padding: 10px 30px;
          border-radius: 7px;
	  max-width: 800px;
	  text-align: center;
	}
	</style>
<p style="margin-bottom:1cm;"></p>
<p><b>Mise à jour 21/11</b> : le R de la deuxième semaine est fixé et évalué à 1,1, les cas réels ont été ajoutés.<br>
  <b>Mise à jour 05/11</b> : le R de la première semaine est fixé et évalué à 1,35, les cas réels ont été ajoutés.</>
<p style="margin-bottom:1cm;"></p>
<p>Ce simulateur permet de calculer la durée du confinement en fonction de la valeur du taux de reproduction du Coronavirus sur chaque semaine. Plus le taux de reproduction est élevé, plus le confinement devra durer longtemps. Plus d'informations sur ce taux de reproduction en bas de page. </p>

	<div class="myDiv">

	<div>
		<h2>Taux de reproduction</h2>
    <p>Merci de sélectionner une valeur du taux de reproduction R<sub>effectif</sub> pour chaque semaine. Pour cela, il vous suffit de faire glisser les points ci-dessous. Le premier point n'est pas modifiable, car il représente le taux de reproduction sur la semaine écoulée.</p>

<p>La valeur actuelle du taux de reproduction est visible <a href="https://raw.githubusercontent.com/rozierguillaume/covid-19/master/images/charts/france/reffectif.jpeg">sur ce graphique</a>. Pour information, le R<sub>effectif</sub> varie en général de 0,5 à 5. Il est actuellement d'environ 1,35. Lors de la première vague, il est descendu à 0,7.</p>
    
    </div>

    <center>
      <canvas id="chartJSContainer" style="height: 400px; max-width: 100%;"></canvas>
      <button onclick="removeWeek()">- Supprimer</button>
      <button onclick="addWeek()">+ Ajouter</button>
    </center>

	</div>
	<br>
	<div class="myDiv">
		<h2>Durée du confinement</h2>
<p><i>Ceci n'est qu'une simulation. Les nombres effectivement observés pourront être différents.</i></p>
	<p>Pour atteindre l'objectif évoqué par Emmanuel Macron (5 000 cas quotidiens, soit 35 000 cas par semaine), et avec les valeurs de R<sub>effectif</sub> que vous avez choisies, le confinement devra durer : </p>
	    <h3 id="resultat">-- semaines</h3>
            <span style="color: #ff0000"><i id="message_erreur">Merci de modifier au moins une valeur de R sur le graphique du haut</i></span>
<p style="margin-bottom:2cm;"></p>
     <center>
     <canvas id="chart_cas" style="height: 400px; max-width: 100%;"></canvas>
     </center>

	</div>
<p style="margin-bottom:2cm;"></p>
<div>
<h2>Explications</h2>
<p>Les images ci-dessous permettent de comprendre la signification du taux de reproduction du virus d'une épidémie, appelé R<sub>effectif</sub>.</p> 


<div class="myDiv2">
<img width=" 100%" =""="" src="https://covidtracker.fr/wp-content/uploads/2020/11/calculateur_confinement_diapo1.jpg">
<img width="100%" src="https://covidtracker.fr/wp-content/uploads/2020/11/calculateur_confinement_diapo2.jpg">
<img width="100%" src="https://covidtracker.fr/wp-content/uploads/2020/11/calculateur_confinement_diapo3.jpg">
<img width="100%" src="https://covidtracker.fr/wp-content/uploads/2020/11/calculateur_confinement_diapo4.jpg">
</div>
</div>
<p style="margin-bottom:1cm;"></p>
<p>Auteurs : <a href="https://twitter.com/eorphelin">Elias Orphelin</a>, <a href="https://twitter.com/guillaumerozier">Guillaume Rozier</a></p>





    <script>
 var weeks = ["30/10 - 6/11", "7/11 - 13/11", "14/11 - 20/11", "21/11 - 27/11", "28/11 - 03/12", "04/12 - 10/12", "11/12 - 17/12", "18/12 - 24/12", "25/12 - 31/12", "01/01 - 07/01", "08/01 - 14/01", "15/01 - 21/01", "22/01 - 28/01", "29/01 - 04/02", "05/02 - 11/02", "12/02 - 18/02"]

var ctx = document.getElementById('chart_cas');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [],
        datasets: [

{
            label: 'Projection du nombre de cas',
            data: [],
          borderColor: [
                'black',
                'black'
            ],
            borderWidth: 2
        },
{
            label: 'Objectif',
            data: [],
            type: 'line',
            fill: false,
           datalabels: {
                labels: {
                    title: null
                }
            }
        },
           ]
    },
    options: {

plugins: {
      datalabels: {
      	color: 'grey',
        anchor: 'end',
        align: 'top',
        formatter: Math.round,
        font: {
          weight: 'bold'
        }
      }
    },
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});


      var values_data = [1.35, 0.7, 0.6, 0.7]
      var cas_last7 = [301122, 175225]
     
      fetch('https://raw.githubusercontent.com/rozierguillaume/covid-19/master/data/france/stats/stats.json')
	   .then(response => {
	       if (!response.ok) {
	           throw new Error("HTTP error " + response.status);
	       }
	       return response.json();
	   })
	   .then(json => {
	       this.data = json;
	       //cas_last7 = parseInt(data["tests_last7"]["valeur"].replace("+", "").replaceAll(" ", ""));

	   })
	   .catch(function () {
	       this.dataError = true;
	   })
      

      function addWeek(){
      	semaines = values_data.length
      	//values_data = values_data.push(1)
        if(window.test.data.labels.length > weeks.length-1){
      window.test.data.labels.push("Semaine " + (window.test.data.labels.length-1).toString());
} else {
      	window.test.data.labels.push(weeks[window.test.data.labels.length]);
}
    	window.test.data.datasets.forEach((dataset) =>  {
            if(values_data.length-1 <= 0){
                 dataset.data.push(1.45);
                 values_data.push(1.45);
                 dataset.data.push(0.9);
                 values_data.push(0.9);
        }else{
             dataset.data.push(values_data[values_data.length-1]);
            values_data.push(values_data[values_data.length-1]);
       }
        
        
    	});
    	//document.getElementById("values").innerHTML = window.test.data.datasets[0].data.toString();
    	window.test.update();
    	//calculerSemaines();

      }

      function removeWeek(){
      		semaines = values_data.length
		    window.test.data.labels.pop();
		    window.test.data.datasets.forEach((dataset) => {
		    dataset.data.pop();
		    values_data.pop();
		    });
		    //document.getElementById("values").innerHTML = window.test.data.datasets[0].data.toString();
		    window.test.chart.update();
		    //calculerSemaines();

		}

		function updateNumberOfWeeks(nbOfWeeks){
			new_values_data = values_data

				while(nbOfWeeks != window.test.data.labels.length){

				if(nbOfWeeks > window.test.data.labels.length){
					addWeek();
				}
				else{
					removeWeek();
				}
				}


		}

		function calculerSemaines(){
			
   			cas_semaines = [...cas_last7]

   			var values_data_temp = values_data

        console.log(cas_semaines)

   			while(cas_semaines[cas_semaines.length-1] > 35000){
          console.log("lol")
   				if(values_data_temp.length <= cas_semaines.length){
   					     values_data_temp.push(Math.min(values_data_temp[values_data_temp.length-1], 0.7));
   				}


       			cas_semaine_suivante = cas_semaines[cas_semaines.length-1] * values_data_temp[cas_semaines.length]


       			cas_semaines.push(cas_semaine_suivante)

       			
             }
             updateNumberOfWeeks(cas_semaines.length+1);

             document.getElementById("resultat").innerHTML = cas_semaines.length-1 + " semaines";
             document.getElementById("message_erreur").innerHTML = "";

              var newlabels=[];
              for (i = 0; i < cas_semaines.length; i++) { 
                if(i > weeks.length-1){
                     newlabels.push("Semaine " + (i).toString());
                 } else {
      	             newlabels.push(weeks[i]);
               }
               }
             myChart.data.labels = newlabels;

             myChart.data.datasets.forEach((dataset) => {
                 //dataset.data[0] = cas_semaines;
            });
             myChart.data.datasets[0].data = cas_semaines;
             objectif=[]
             colors=[]
             for (i = 0; i < cas_semaines.length; i++){
                   objectif.push(35000);
                   colors.push("red")
               }
             colors.pop();
             colors.push("green");
             myChart.data.datasets[0].backgroundColor = colors;
             myChart.data.datasets[1].data = objectif;


           myChart.update();
             

	}

	//calculerSemaines()


      var options = {
      	plugins: {
      datalabels: {
      	color: '#36A2EB',
        anchor: 'end',
        align: 'top',
        formatter: Math.round,
        font: {
          weight: 'bold'
        }
      }
    },
        type: 'line',
        data: {
          labels: [weeks[0], weeks[1], weeks[2], weeks[3]],
          datasets: [
            {
              label: 'Taux de reproduction R',
              data: values_data,
              pointBackgroundColor: ["white", "white"],
              pointBorderColor: [],
              borderWidth: 1,
              pointRadius: 15,
              pointHitRadius: 25
            }
          ]
        },
        options: {
          scales: {
            yAxes: [{
                ticks: {
                    max: 2,
                    min: 0
                }
            }]
          },
          responsive: false,
          dragData: true,
          dragDataRound: 1,
          dragOptions: {
            showTooltip: true
          },
          onDragStart: function(e, datasetIndex) {
            //console.log(e)
            //return false
          },
          onDrag: function(e, datasetIndex, index, value) {
            e.target.style.cursor = 'grabbing'
            // console.log(datasetIndex, index, value)
            if(index in [0, 1]){
              return false}
          },
          onDragEnd: function(e, datasetIndex, index, value) {
            e.target.style.cursor = 'default' 
            // console.log(datasetIndex, index, value)
            values_data[index] = value;
            //document.getElementById("values").innerHTML = window.test.data.datasets[0].data.toString();
            calculerSemaines();


          },
          hover: {
            onHover: function(e) {
              const point = this.getElementAtEvent(e)
              if (point.length) e.target.style.cursor = 'grab'
              else e.target.style.cursor = 'default'
            }
          }
        }
      }

      var ctx = document.getElementById('chartJSContainer').getContext('2d');
      window.test = new Chart(ctx, options);
    </script>
<!-- /wp:html -->

<!-- wp:spacer {"height":50} -->
<div style="height:50px" aria-hidden="true" class="wp-block-spacer"></div>
<!-- /wp:spacer -->